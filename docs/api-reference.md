# JQL API Reference

JQL is organized into logical namespaces to separate the **Core Engine** from **Runtimes** and **Adapters**.

## üöÄ Runtimes

Runtimes are the primary way to execute JQL queries against data sources.

### `read(source: ReadableStream | Uint8Array, schema: string): Promise<any>`

The standard "Pull-Mode" executor.

- **`source`**: A binary stream or byte array.
- **`schema`**: The JQL query string.
- **Returns**: A promise resolving to the final projected object.
- **Use Case**: One-off data extraction from files or API responses.

### `subscribe(source: ReadableStream, schema: string, options: SubOptions): void`

The high-performance "Push-Mode" executor.

- **`options.onMatch(data: any)`**: Called instantly when a match is found.
- **`options.onComplete()`**: Called when the stream ends.
- **`options.onError(err: Error)`**: Error handling hook.
- **Use Case**: Real-time telemetry, log monitoring, and live dashboards.

---

## üîå Adapters

Adapters provide specialized logic for specific data formats.

### `ndjsonStream(stream: ReadableStream, schema: string): AsyncGenerator<any>`

Optimized for Line-Delimited JSON (NDJSON/JSONL).

- **Optimization**: Uses binary line splitting and Engine recycling to achieve near-native speeds.
- **Throughput**: Verified at 230k+ matches per second.

---

## üß† Core Engine

The low-level FSM architecture for library authors and custom adapters.

### `new Tokenizer(options?: { debug?: boolean })`

- **`processChunk(chunk: Uint8Array, onToken: (t: Token) => void)`**: The zero-allocation hot loop.

### `new Engine(map: JQLMap, options?: { debug?: boolean })`

- **`processChunk(chunk: Uint8Array)`**: Consumes binary chunks and drives the selection state machine.
- **`reset()`**: Recycles the engine state for the next document (used heavily in NDJSON).

---

## üõ°Ô∏è Types

### `Token`

```typescript
interface Token {
  type: TokenType;
  value?: any;     // Only for STRING and NUMBER
  start: number;   // Byte offset
  end: number;
}
```

### `JQLMap`

A compiled representation of the JQL query, generated by the `JQLParser`.
